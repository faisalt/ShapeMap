<!doctype html>
<head>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<script type="text/javascript" src="JavaScript/ShapeClipAPI.js"></script>
	<script type="text/javascript" src="config.js"></script>
	<link rel=StyleSheet href="style.css" type="text/css">
</head>

<body>
<h1 style="font-family:calibri">ShapeMap</h1>

<br>
<br>
<div id="maindiv"></div>

</body>

</html>

<script type="text/javascript">

var pads = [];

var PAUSED_STATE=true;
var PLAY_STATE=true;

$(document).ready(function() {
	var max=10;
	var ypos = 230;
	createGrid(max,ypos);
	mapValues(pads);

	(function theLoop (i) {
		setTimeout(function () {
			if(i<50){
				}
			//clearGrid();
			//createGrid(max++, ypos);
			moveGrid();
			mapValues(pads);
			if (--i) {          // If i > 0, keep going
				theLoop(i);       // Call the loop again, and pass it the current value of i
			}
		}, 10);
	})(1500);
	$("html").click(function(e){
	   var parentOffset = $(this).offset(); 
	   //or $(this).offset(); if you really just want the current element's offset
	   var relX = e.pageX - parentOffset.left;
	   var relY = e.pageY - parentOffset.top;
	   console.log(relX);
	});
});

function clearGrid() {
	$('div#maindiv').empty();
	pads = [];
}
count=0;
function moveGrid() {
	count++;
	$('div.sc_pad').each(function() {
		$(this).css("margin-left", count);
	});
}

/*
* This creates the pixel grid that controls the ShapeClips color and height
*/
function createGrid(xval, yval) {
	var x=1;
	var y=1;
	var count=1;
	// Correct ppi value.
	var agent = navigator.userAgent.toLowerCase();
	if 		(agent.indexOf("windows") 	!= -1) 	{ }
	if 		(agent.indexOf("nexus 5") 	!= -1) 	{ __ppi(150); }
	else if (agent.indexOf("ipad") 		!= -1) 	{ __ppi(160); }
	else if (agent.indexOf("nexus 10") 		!= -1) 	{ __ppi(180); }
	console.log("User Agent: " + agent);
	
	if(forcePPI>0) {
		__ppi(forcePPI); //for the Microsoft Surface
	}	
	
	// The size of the shape-clip pad in mm.
	var SC_SIZE = __px(20);
	// The starting position of the grid
	var X = xval;	var Y = yval;
	
	for (var x = 0; x < h_max; ++x) {
		for (var y = 0; y < v_max; ++y) {
			var pX = X + (x * 25); // horizontal spacing between pixels	
			var pY = Y + (y * 25); // vertical spacing between pixels			
			var pad = null;
			pad = new ShapeClip({x: __px(pX), y: __px(pY), width: SC_SIZE, height: SC_SIZE});
			
			//pad._id = "" + x + "x" + y;
			pad._id="pixel_"+count;
			count++;
			pad.outline(true);
			pad.rotate(180);
			pad.PULSE_WIDTH=OVERRIDE_PULSE_WIDTH;
			pads.push(pad);
			$('div#maindiv').append(pad._element);
		}
	}
	
	for (var i=0; i<pads.length; ++i) { pads[i].colour(0,255,0); pads[i].pulse(); }
}

function mapValues(pads, values) {
	var count=0;
	var leftOffset = $('div.sc_control').last().offset().left;
	for(var i=0; i<pads.length; i++) {
		//pads[i].height(values[i]*0.01);
		var padelement = pads[i]._element;
		var loffset = $(padelement).offset().left;
		if(loffset > 312 && loffset < 700) {
			var val=256; pads[i].height(val*0.01);
		} else if(loffset > 750 && loffset < 1220) {
			pads[i].colour(255,0,255);
		} else {
			var val=0; pads[i].height(val*0.01);
			pads[i].colour(0,255,0); 
		}
	}
}

</script>